<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles/reset.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/style.css">
    <title>Timer</title>
    <script src="/scripts/timer.js" defer></script>
</head>

<body>
    <div id="burn-timer" class="burn-timer">
        <div class="flame-icon">üî•</div>
        <div class="timer-text">–í–∞—à–∏ 500‚ÇΩ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑:</div>
        <div class="time-display">
            <span id="days">03</span><span class="time-unit">–¥</span>
            <span id="hours">00</span><span class="time-unit">—á</span>
            <span id="minutes">00</span><span class="time-unit">–º</span>
            <span id="seconds">00</span><span class="time-unit">—Å</span>
        </div>
        <div class="urgency-tag">–ü–æ—Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å!</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 1. –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–¥–ª–∞–π–Ω–∞ (UTC + 3 –¥–Ω—è)
            function createNewDeadline() {
                const deadline = new Date();
                deadline.setUTCDate(deadline.getUTCDate() + 3);
                deadline.setUTCHours(23, 59, 59, 0); // –§–∏–∫—Å–∏—Ä—É–µ–º –∫–æ–Ω–µ—Ü –¥–Ω—è
                return deadline;
            }

            // 2. –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–µ–¥–ª–∞–π–Ω (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–ª—è GitHub)
            function getDeadline() {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –Ω–∞ GitHub Pages
                if (window.location.hostname.includes('github.io')) {
                    localStorage.removeItem('deadline');
                }

                const saved = localStorage.getItem('deadline');
                if (!saved) {
                    const newDeadline = createNewDeadline();
                    localStorage.setItem('deadline', newDeadline.getTime());
                    return newDeadline;
                }

                const savedDeadline = new Date(parseInt(saved));
                const now = new Date();

                if (savedDeadline <= now) {
                    localStorage.removeItem('deadline');
                    return createNewDeadline();
                }

                return savedDeadline;
            }

            // 3. –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            const deadline = getDeadline();
            console.log("–î–µ–¥–ª–∞–π–Ω:", deadline.toUTCString());

            function updateTimer() {
                const now = new Date();
                const diff = deadline - now;

                // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
                const daysEl = document.getElementById('days');
                const hoursEl = document.getElementById('hours');
                const minutesEl = document.getElementById('minutes');
                const secondsEl = document.getElementById('seconds');
                const urgencyTag = document.querySelector('.urgency-tag');

                // –ï—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ
                if (diff <= 0) {
                    daysEl.textContent = '00';
                    hoursEl.textContent = '00';
                    minutesEl.textContent = '00';
                    secondsEl.textContent = '00';
                    urgencyTag.textContent = '–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!';
                    urgencyTag.style.background = '#f44336';
                    return;
                }

                // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤ UTC
                const totalSec = Math.floor(diff / 1000);
                const days = Math.floor(totalSec / (3600 * 24));
                const hours = Math.floor((totalSec % (3600 * 24)) / 3600);
                const mins = Math.floor((totalSec % 3600) / 60);
                const secs = totalSec % 60;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
                daysEl.textContent = days.toString().padStart(2, '0');
                hoursEl.textContent = hours.toString().padStart(2, '0');
                minutesEl.textContent = mins.toString().padStart(2, '0');
                secondsEl.textContent = secs.toString().padStart(2, '0');

                // –≠—Ñ—Ñ–µ–∫—Ç —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
                if (days === 0 && hours < 3) {
                    document.querySelector('.burn-timer').style.background = '#ffebee';
                    urgencyTag.style.animation = 'pulse 0.5s infinite';
                }
            }

            setInterval(updateTimer, 1000);
            updateTimer();
        });
    </script>
</body>

</html>