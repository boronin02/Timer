<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles/reset.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/style.css">
    <title>Timer</title>
    <script src="/scripts/timer.js" defer></script>
</head>

<body>
    <div id="burn-timer" class="burn-timer">
        <div class="flame-icon">üî•</div>
        <div class="timer-text">–í–∞—à–∏ 500‚ÇΩ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑:</div>
        <div class="time-display">
            <span id="days">03</span><span class="time-unit">–¥</span>
            <span id="hours">00</span><span class="time-unit">—á</span>
            <span id="minutes">00</span><span class="time-unit">–º</span>
            <span id="seconds">00</span><span class="time-unit">—Å</span>
        </div>
        <div class="urgency-tag">–ü–æ—Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å!</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 1. –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–¥–ª–∞–π–Ω–∞ (UTC + 3 –¥–Ω—è)
            function createNewDeadline() {
                const deadline = new Date();
                deadline.setUTCDate(deadline.getUTCDate() + 3);
                deadline.setUTCHours(23, 59, 59, 0); // –§–∏–∫—Å–∏—Ä—É–µ–º –∫–æ–Ω–µ—Ü –¥–Ω—è
                return deadline;
            }

            // 2. –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–µ–¥–ª–∞–π–Ω (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–ª—è GitHub)
            function getDeadline() {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –Ω–∞ GitHub Pages
                if (window.location.hostname.includes('github.io')) {
                    localStorage.removeItem('deadline');
                }

                const saved = localStorage.getItem('deadline');
                if (!saved) {
                    const newDeadline = createNewDeadline();
                    localStorage.setItem('deadline', newDeadline.getTime());
                    return newDeadline;
                }

                const savedDeadline = new Date(parseInt(saved));
                const now = new Date();

                if (savedDeadline <= now) {
                    localStorage.removeItem('deadline');
                    return createNewDeadline();
                }

                return savedDeadline;
            }

            // 3. –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            const deadline = getDeadline();
            console.log("–î–µ–¥–ª–∞–π–Ω:", deadline.toUTCString());


            function updateTimer() {
                const now = new Date();
                const diff = deadline - now;

                // –ï—Å–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ
                if (diff <= 0) {
                    document.getElementById("days").textContent = "00";
                    document.getElementById("hours").textContent = "00";
                    document.getElementById("minutes").textContent = "00";
                    document.getElementById("seconds").textContent = "00";
                    return;
                }

                // –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º "—Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è"
                const totalSeconds = Math.floor(diff / 1000);
                const days = Math.ceil(totalSeconds / (3600 * 24)); // –ò—Å–ø–æ–ª—å–∑—É–µ–º Math.ceil –≤–º–µ—Å—Ç–æ Math.floor
                const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                document.getElementById("days").textContent = days.toString().padStart(2, '0');
                document.getElementById("hours").textContent = hours.toString().padStart(2, '0');
                document.getElementById("minutes").textContent = minutes.toString().padStart(2, '0');
                document.getElementById("seconds").textContent = seconds.toString().padStart(2, '0');
            }

            setInterval(updateTimer, 1000);
            updateTimer();
        });
    </script>
</body>

</html>
